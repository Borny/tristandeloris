parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"oCke":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.r=v,exports.w=I,exports.u=exports.i=exports.a=void 0;const e=(e,t)=>t.some(t=>e instanceof t);let t,r;function n(){return t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function o(){return r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}exports.i=e;const s=new WeakMap,i=new WeakMap,a=new WeakMap,c=new WeakMap,u=new WeakMap;function p(e){const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("success",o),e.removeEventListener("error",s)},o=()=>{t(I(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&s.set(t,e)}).catch(()=>{}),u.set(t,e),t}function f(e){if(i.has(e))return;const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",s),e.removeEventListener("abort",s)},o=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",o),e.addEventListener("error",s),e.addEventListener("abort",s)});i.set(e,t)}exports.a=u;let d={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return i.get(e);if("objectStoreNames"===t)return e.objectStoreNames||a.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return I(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function v(e){d=e(d)}function D(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?o().includes(e)?function(...t){return e.apply(B(this),t),I(s.get(this))}:function(...t){return I(e.apply(B(this),t))}:function(t,...r){const n=e.call(B(this),t,...r);return a.set(n,t.sort?t.sort():[t]),I(n)}}function m(t){return"function"==typeof t?D(t):(t instanceof IDBTransaction&&f(t),e(t,n())?new Proxy(t,d):t)}function I(e){if(e instanceof IDBRequest)return p(e);if(c.has(e))return c.get(e);const t=m(e);return t!==e&&(c.set(e,t),u.set(t,e)),t}const B=e=>u.get(e);exports.u=B;
},{}],"yvr6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.deleteDB=n,exports.openDB=t,Object.defineProperty(exports,"unwrap",{enumerable:!0,get:function(){return e.u}}),Object.defineProperty(exports,"wrap",{enumerable:!0,get:function(){return e.w}});var e=require("./wrap-idb-value.js");function t(t,n,{blocked:r,upgrade:o,blocking:d,terminated:i}={}){const s=indexedDB.open(t,n),a=(0,e.w)(s);return o&&s.addEventListener("upgradeneeded",t=>{o((0,e.w)(s.result),t.oldVersion,t.newVersion,(0,e.w)(s.transaction))}),r&&s.addEventListener("blocked",()=>r()),a.then(e=>{i&&e.addEventListener("close",()=>i()),d&&e.addEventListener("versionchange",()=>d())}).catch(()=>{}),a}function n(t,{blocked:n}={}){const r=indexedDB.deleteDatabase(t);return n&&r.addEventListener("blocked",()=>n()),(0,e.w)(r).then(()=>void 0)}const r=["get","getKey","getAll","getAllKeys","count"],o=["put","add","delete","clear"],d=new Map;function i(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(d.get(t))return d.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,s=o.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!r.includes(n))return;const a=async function(e,...t){const r=this.transaction(e,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),s&&r.done]))[0]};return d.set(t,a),a}(0,e.r)(e=>({...e,get:(t,n,r)=>i(t,n)||e.get(t,n,r),has:(t,n)=>!!i(t,n)||e.has(t,n)}));
},{"./wrap-idb-value.js":"oCke"}],"GGUP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.writeData=r,exports.readAllData=n,exports.setStore=o,exports.getItem=a,exports.getAllKeys=s,exports.deleteItem=c,exports.clearStore=l,exports.urlBase64ToUint8Array=i,exports.dataURItoBlob=u;var t=require("idb");const e=(0,t.openDB)("posts-store",1,{upgrade(t){t.objectStoreNames.contains("posts")||(console.log("[Utility JS] : creating the database"),t.createObjectStore("posts")),t.objectStoreNames.contains("sync-posts")||t.createObjectStore("sync-posts")}});async function r(t,r){return console.log("write data",r),e.then(e=>{const n=e.transaction(t,"readwrite");return n.objectStore(t).put(r),n.complete})}async function n(t){return e.then(function(e){return e.transaction(t,"readonly").objectStore(t).getAll()})}async function o(t,r,n){return console.log("setting store"),(await e).put(n,r,t)}async function a(t,r){return(await e).get(r,t)}async function s(t){return(await e).getAllKeys(t)}async function c(t,r){return console.log("delete store"),(await e).delete(t,r)}async function l(t){return(await e).clear(t)}function i(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),r=window.atob(e),n=new Uint8Array(r.length),o=0;o<r.length;++o)n[o]=r.charCodeAt(o);return n}function u(t){for(var e=atob(t.split(",")[1]),r=t.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(e.length),o=new Uint8Array(n),a=0;a<e.length;a++)o[a]=e.charCodeAt(a);return new Blob([n],{type:r})}
},{"idb":"yvr6"}],"vCsh":[function(require,module,exports) {
"use strict";var e=require("../js/utility");const t="http://localhost:9000/api/feed",o=document.getElementsByTagName("body")[0],n=document.getElementById("post-list"),s=document.getElementById("add-post"),i=document.getElementById("modal-backdrop"),a=document.getElementById("feed-modal"),l=document.getElementById("close-modal-btn"),c=document.getElementById("create-form"),d=document.getElementById("title"),r=document.getElementById("src"),m=document.getElementById("player"),g=document.getElementById("canvas"),y=document.getElementById("loading-camera"),v=document.getElementById("capture-btn"),p=document.getElementById("pick-image"),u=document.getElementById("location-btn"),h=document.getElementById("location-loader"),E=document.getElementById("image-picker"),b=document.getElementById("switch-camera-btn"),f="posts",w="sync-posts",k="sync-new-posts";let L,I=!1;const B={facingMode:"user"},D={facingMode:{exact:"environment"}};let M,U=D,_=!0;u.addEventListener("click",()=>{u.style.display="none",h.style.display="block","geolocation"in navigator&&navigator.geolocation.getCurrentPosition(function(e){console.log("geo success"),u.style="block",h.style="none",L={lat:e.coords.latitude,lon:e.coords.longitude},console.log(L)},function(){console.log("geo error"),u.style="block",h.style="none",alert("Counldn't fetch the location...")})});const j=async()=>{try{const o=await fetch(t),n=(await o.json()).data;G(),n.forEach(e=>{x(e,"fetch")}),I=!0}catch(e){console.log("could not fetch images"),fetchError=!0}};j();const C=()=>{"geolocation"in navigator||(u.style.display="none")},S=()=>{"mediaDevices"in navigator||(console.log("no media devices"),navigator.mediaDevices={}),"getUserMedia"in navigator.mediaDevices||(navigator.mediaDevices.getUserMedia=(e=>{const t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise((o,n)=>{t.call(navigator,e,o,n)}):Promise.reject(new Error("Get user media is not implemented"))})),T()},T=()=>{y.style.display="block",m.style.display="none",navigator.mediaDevices.getUserMedia({video:{facingMode:_?"user":"environment"}}).then(e=>{_?(m.classList.add("inverse"),g.classList.add("inverse")):(m.classList.remove("inverse"),g.classList.remove("inverse")),m.srcObject=e,y.style.display="none",m.style.display="block"}).catch(e=>{console.log("error video:",e),y.style.display="none",p.style.display="block"})};b.addEventListener("click",()=>{console.log("click"),_=!_,P(),T()}),v.addEventListener("click",()=>{g.style.display="block",m.style.display="none",v.style.display="none";const t=g.getContext("2d");console.log(g.clientWidth,m.videoHeight,g.width),t.drawImage(m,0,0,g.clientWidth,m.videoHeight/(m.videoWidth/g.width)),M=(0,e.dataURItoBlob)(g.toDataURL())});const P=()=>{m.srcObject&&m.srcObject.getVideoTracks().forEach(e=>e.stop())};"indexedDB"in window&&(I||(console.log("[Feed JS] : indexeddb"),(0,e.getAllKeys)("posts").then(t=>{G(),t.forEach(t=>{(0,e.getItem)(t,"posts").then(e=>{x(e,"indexeddb")})})})));const G=()=>{for(;n.hasChildNodes();)n.removeChild(n.lastChild)},x=(e,t)=>{console.log("[Feed JS]: update UI",t);const{_id:o,src:s,title:i,image:a}=e,l=document.createElement("li");l.setAttribute("id",o),l.classList.add("post__item"),l.innerHTML='\n    <img src="'.concat(a,'" alt="').concat(i,'" class="post__img"/>\n        <p class="post__title">').concat(i,'</p>\n        <button class="btn post__delete-btn">Delete</button>\n        '),n.appendChild(l),l.querySelector(".post__delete-btn").addEventListener("click",()=>{W(l,e,o)})};function O(){m.style.display="none",p.style.display="none",g.style.display="none",y.style.display="none",v.style.display="block",P(),m.classList.remove("inverse"),g.classList.remove("inverse"),o.classList.remove("modal--open"),setTimeout(()=>{i.classList.remove("visible"),a.classList.remove("visible")},1)}s.addEventListener("click",()=>{"mediaDevices"in navigator||(console.log("no media devices"),navigator.mediaDevices={}),"getUserMedia"in navigator.mediaDevices||(navigator.mediaDevices.getUserMedia=(e=>{const t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise((o,n)=>{t.call(navigator,e,o,n)}):Promise.reject(new Error("Get user media is not implemented"))})),T(),"geolocation"in navigator||(u.style.display="none"),i.classList.add("visible"),a.classList.add("visible"),o.classList.add("modal--open")}),l.addEventListener("click",()=>{O()});const W=async(o,s,i)=>{try{await fetch("".concat(t,"/").concat(i),{method:"DELETE",mode:"cors",headers:{"Content-Type":"application/json"}});n.removeChild(o),(0,e.deleteItem)("posts",s.title)}catch(a){console.log("delete error",a)}};c.addEventListener("submit",e=>A(e));const A=t=>{if(t.preventDefault(),""===d.value.trim()||""===r.value.trim())return void alert("Please enter valid data!");const o={title:d.value.trim(),picture:M};if(O(),"serviceWorker"in navigator&&"SyncManager"in window)navigator.serviceWorker.ready.then(t=>{(0,e.clearStore)(w),console.log("formData",o),(0,e.setStore)(o.title,o,w).then(()=>t.sync.register("sync-new-posts")).then(()=>{alert("the post was saved for sync")})}).catch(e=>{console.log("set store sync error:",e)});else{if(console.log("no service worker or sync manager"),201!==H(o).status)throw new Error("Something went wrong");console.log("res status 201"),x(o)}};function H(e){return fetch("http://localhost:9000/api/feed",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)})}
},{"../js/utility":"GGUP"}]},{},["vCsh"], null)